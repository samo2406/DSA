#include <stdio.h>
#include <math.h>
#include <time.h>
#include "BDD.C"

char *randomVektor(int pocetPremennych) {
    int i;
    char *V = malloc(pow(2,pocetPremennych)+1);
    for(i = 0; i < pow(2,pocetPremennych); i++)
        V[i] = rand() % 2 + '0';
    V[i] = '\0';
    return V;
}

void test(int pocetPremennych, int pocetOpakovani) {
    double createTime = 0, reduceTime = 0, percentaU = 0;
    unsigned long int odstraneneU = 0;
    char *vstupnyVektor;
    BF *bf;
    BDD *bdd;

    for(int i = 0; i < pocetOpakovani; i++) {
        //vstupnyVektor = randomVektor(pocetPremennych);
        //vstupnyVektor = "1000000011100010011000000000101001100110101101010100101110111001";
        vstupnyVektor = "11001000001111111010100100100110101011101101101110100111111001000000000101000110110000001001011000111110001010110001111000101110100010001111111111101000001001010101011100100001010010110000110101110110101101100100011011111101000000011011000001010110010001000011100010011110011000111011110101001100101101001101101001111011110111100100100101011111000110100010001110100101100011010000110101100000011011011010010011011110101110111100000010100011100110001011000010011000100100010101100100111011101000101111000000111110000101010100111001101010111000101010100011000101111100101011111110011000001101111110101001111110001100111010010100101111001100010101100010011100101101101000110101111001101111101011111001010010100011011101011000111000011110010010111000101110101000110001011111011101101111110000100000110001011010110011100100111110010011000000110100111001000000011101111000001100001010100011100000011010110110010001110101111100110100101001111111001011110100001000011111001010011010110000110111110101001100011010110000011000101011010110110000111000010001000100101010001011010010000100001110010000010000110101010100110100010110100000010111111000101010110101101010100011111011000011010000001001111111110011001010111100010000010001100001000101111100101001000101011000101000101000111010101000010001001110100101010110110101011110010100111111000010110001011111110000010010101000000101110110000110101111001000001001011000010000101001111110001101100011001001111001010001110110010111110100000101110000101101000111001100010100010100001001001011011100001010111100110110011001110010001110011001111100011001100111110000111011011100100100011111101100011000100011011101100101111001001001011010100001111101111001111011011001101100101101000010010010101011000001001101001111001110010101010111101000100100111110111110111001110100011000110101001111110110010011101000101010001000000100011010011010101011001010100000100011111011111101111011000011001011010010100011101110100110101110011111101101100001001100111011111111011001111010000110001001100101100011100101111000100011010001011001111010101111010110001100100111000111011111110111001111100001101110110101101110000100100110101000011111101101110101000101101101101101010111101000111101010110010100101000011010010001111101001110010101001000101101011110010111001000010101000010011110000001100110011110111001100001101001101101110010110011110101011110111011100111111101000101001000011011010000011100011101011010111101001010111111010111101011010010100101010011010100101110001011000001101111100011001001001001011101011011011001100001011010101010101101111011011010010010011101001001010111010100010011100110101111101101111011001110100001100010101100110111100001110000001010010110000010001000001100100100010001101100100010101111010101110001101110101010100011011001111101100101010101100110101110100010010111101101100000101101000011100011011011000100100001010001011111100011000010100011010101111001101110110101111110111001110011110011101111100010010001100001111110001001010000010110111001101100000011101101011110110111010010011110010100101000010100011011111011010100010111001110000000101111011110011110101100110000001100001101000001110011000001111010110100111011101010011011001111000011111110010110001101000001010111101111011001010000110110011000111001010100110011110100011011100101000101010100111000011011011101110111000110111111111000000011010010010110011110101110110110000010000011000110110110111011000010110010101111000111100010101001101101010101100101011000100101110010100110011101101100011100001110010010000100110010111111000011001000000100101110100011111100011011100110111001110110100101000111001110100111110011000010101111000100011111001100001100000011010001100110111011001100101000010101111010011010110110110011000101000101110110011000101100000100001010001010100010101011000010110000101000010011000100001001011100010110111111010110100110001001011111100001111111000011011011010101100111001100001000011110100000010000011011111101010011001001011010101010100111000000001001010010000000100001100011001100101110100111111110011101110011100100011100000101001000001000001111110011010111010011110000011111100111011011001000011010011011111111101100001000001101010001001100011110101000101100001011010111001000001000001000110100110000110101100011010001111011110001110110110111111100010100001001000010110100101000100100111101100001011010001000110000000001011110111111010110110011011111100000011000001111111100111101110011011011011110111110100110110110111101010100110001101110010101110000010001100010001000101000001111011000001101001100100100010001000010110011111001111010010000011000001100000100010000101011100101011111101011001001010110000101001111000101000010001110111110111001000011110000100000011010000110010110011000101111010001111011010010000011000010001101011100100100000011100110101110001000110001001100110000110001001101000110111001111010010111001010110101110100011111101110000000110111010110100001010000101011110100101010011000110101110101101110111011110001011011000010001110001010100111111000011100100001101110001010111111111101100100001101111111111101011101101100010100100100000011100100000010010000000001010101001000110001101000111100100011000011111000011001110110000000111111101100001000000011111111101000011101010001011111011011100001011101010001100011010011110111001011100011100000100010101101111010000111010100000110111010010011110000010010001101110101100010110100010111000010001010110001110100010000101110111011101000110110000011111010001111000101111110111110010001101110110101010100001111101000001000000111110100100000010111110011010001011100100000101111001010111111101010000101001001011001111110010001011100101000110111111101001010001110101000010111011101101101001111111110100001101101010000001111011110111000111101001110011011100011110111000110001001110101011111001001111001110000010010111101000111100011000110000100110110010010000110110010101101010000001001000111011001110010110001101100010101011111011100000111110111100010100010010001100010101110001011110111100100101100100011011001000111111110011111110110000111010001001000000011001011001011000110011011111101101100101001101100101000011100101100110011010110000010110101010111100111111010011100001110000100011010000100100000100011010101111010100111010101011001011110011001010000111100101100100100000111111100011000010111011011011000000101011001110111000100010110000001111101101001000110000101110001101010100111101101000101001101101011011111101101011101110110011011110111000100110001011001010010000100100111100000001100111010010001000101011010100010110010010111000001110101001100111110011001001010000010000100100000000000111110111001001001100011100111011001101010010110111010011110101000100110011011111101101000100111101110101101000001011001011000001101010101110001110110110111101111011100110111111001010110111011011010010100101110011110010110000110110101110110100001110010010110101001011101011011011110011110000000100110110111001011111100000010101101111011011100111001100011010101000001101001000001101111001000111001001011101001011110100010010110111010111101110011010011000110010110101011110110100110000010101111000011011110111111001000110010011111101011011101111111011010010011001111110001010111101100010100101100110110001001001111001000101011110111000001111100000011010011000011011110111101101001010000000111000100100001100101111001011110001000000001101010000101101001000011001010011000011101100101010011000111100111101111101010100110100011101000110100111100000001111001001111011010101101001111110101000011010100100111010010100111011101011111110011011101001010010110011000001001010100010100101010000101001001001110001101111011101111111100011100000100101010110001011110011101001000111010111110101101101011100010000100010110101111001110010010001011111011011000111010100010100101000100110000001101111111010100010111100010000100000011100111011000011110101100000011011010110001000100101101100011101001110110000111000000011010010101110010011111000110101001110100110010100000110000001000111101010110000100110000110010010101101110111111100010001010011101011110111110100101111100001100101001101100100100111001100110011010110110011011001011000111011010100001110010100100110010000111111011000111010100111101110000111010101001";
        clock_t start1 = clock();
        bf = BF_create(vstupnyVektor);
        bdd = BDD_create(bf);
        clock_t stop1 = clock();
        createTime += (double) (stop1 - start1) * 1000.0 / CLOCKS_PER_SEC;
        unsigned int N = pow(2, bdd->n + 1) - 1;
        clock_t start2 = clock();
        BDD_reduce(bdd);
        clock_t stop2 = clock();
        reduceTime += (double) (stop2 - start2) * 1000.0 / CLOCKS_PER_SEC;
        odstraneneU += (spocitajUzly(bdd->koren) + 2);
        //odstraneneU += N - (spocitajUzly(bdd->koren) + 2);
        percentaU += (((spocitajUzly(bdd->koren) + 2.0) / N) * 100.0);
        //percentaU += 100.0 - (((spocitajUzly(bdd->koren) + 2.0) / N) * 100.0);
        char *vystupnyVektor = BDD_use_all(bdd, bdd->n);
        if (strcmp(vstupnyVektor, vystupnyVektor)) {
            printf("Vystupny vektor %s sa nerovna vstupnemu %s\n", vystupnyVektor, vstupnyVektor);
            return;
        }
        free(bf->vektor);
        free(bf);
        free(vystupnyVektor);
        free(vstupnyVektor);
        freeUzly(bdd->koren);
        free(bdd->F->hodnota);
        free(bdd->T->hodnota);
        free(bdd->T);
        free(bdd->F);
        free(bdd);
    }
    printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
    printf("Test BDD pre %d premennych s %d opakovaniami :\n", pocetPremennych, pocetOpakovani);
    printf("Priemerny cas vytvarania           : %.2fms [celkovo %.2fms]\n", createTime/pocetOpakovani, createTime);
    printf("Priemerny pocet uzlov po redukcii  : %.2f (%.2f%%)\n", (double)odstraneneU/pocetOpakovani, percentaU/pocetOpakovani);
    printf("Priemerny cas redukovania          : %.2fms [celkovo %.2fms]\n", reduceTime/pocetOpakovani, reduceTime);
    printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
}

int main() {
    srand(time(NULL));
    test(15,10);
    return 0;
}
